<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             x:Class="AcademiaDoZe.Presentation.AppMaui.Views.LogradouroListPage" 
             xmlns:vm="clr-namespace:AcademiaDoZe.Presentation.AppMaui.ViewModels" 
             x:DataType="vm:LogradouroListViewModel" 
             xmlns:dto="clr-namespace:AcademiaDoZe.Application.DTOs;assembly=AcademiaDoZe.Application" 
             Title="{Binding Title}"
             BackgroundColor="White">
    <Grid>
        <StackLayout Padding="20" Spacing="15">
            <Label Text="{Binding Title}" FontSize="28" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
            <Frame CornerRadius="10" Padding="10">
                <Frame.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#B0B0B0" Offset="0.0"/>
                        <GradientStop Color="#404040" Offset="1.0"/>
                    </LinearGradientBrush>
                </Frame.Background>
                <Grid ColumnDefinitions="Auto,10,*,10,Auto" VerticalOptions="Center">
                    <Picker Grid.Column="0" ItemsSource="{Binding FilterTypes}" SelectedItem="{Binding SelectedFilterType}" WidthRequest="110" HeightRequest="40"/>
                    <Entry Grid.Column="2" Text="{Binding SearchText}" Placeholder="Digite o valor..." HeightRequest="40"/>
                    <Button Grid.Column="4" Text="Buscar" Command="{Binding SearchLogradourosCommand}" WidthRequest="80" HeightRequest="40"/>
                </Grid>
            </Frame>
            <RefreshView IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
                <CollectionView ItemsSource="{Binding Logradouros}" SelectionMode="None">
                    <CollectionView.EmptyView>
                        <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                            <Label Text="Nenhum logradouro encontrado" FontSize="18" TextColor="Gray"/>
                            <Button Text="Adicionar Primeiro Logradouro" Command="{Binding AddLogradouroCommand}" HeightRequest="50" Margin="0,20,0,0"/>
                        </StackLayout>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="dto:LogradouroDTO">
                            <Frame Margin="5" Padding="10" CornerRadius="10" HasShadow="True">
                                <Frame.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#B0B0B0" Offset="0.0"/>
                                        <GradientStop Color="#404040" Offset="1.0"/>
                                    </LinearGradientBrush>
                                </Frame.Background>
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto,Auto">
                                    <StackLayout Grid.RowSpan="5" Grid.Column="0" Spacing="4">
                                        <Label Text="{Binding Cep}" FontAttributes="Bold"/>
                                        <Label Text="{Binding Nome}"/>
                                        <Label Text="{Binding Bairro}"/>
                                        <Label>
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding Cidade}"/>
                                                    <Span Text=" - "/>
                                                    <Span Text="{Binding Estado}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                        <Label Text="{Binding Pais}"/>
                                    </StackLayout>
                                    <Button Grid.Row="0" Grid.Column="1" Text="Editar" Clicked="OnEditButtonClicked" Margin="4,0"/>
                                    <Button Grid.Row="0" Grid.Column="2" Text="Excluir" Clicked="OnDeleteButtonClicked" Margin="4,0"/>
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
        </StackLayout>
        <Button Text="+" Command="{Binding AddLogradouroCommand}" WidthRequest="56" HeightRequest="56" HorizontalOptions="End" VerticalOptions="End" Margin="20">
            <Button.Shadow>
                <Shadow Brush="{AppThemeBinding Light=Black, Dark=Gray}" Offset="0,4" Radius="8" Opacity="0.3"/>
            </Button.Shadow>
        </Button>
        <Grid IsVisible="{Binding IsBusy}" BackgroundColor="#80000000" VerticalOptions="Fill" HorizontalOptions="Fill">
            <ActivityIndicator IsRunning="True" VerticalOptions="Center" HorizontalOptions="Center" Color="White"/>
        </Grid>
    </Grid>
</ContentPage>